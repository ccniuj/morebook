<link rel="stylesheet" href="/jquery-bar-rating/dist/themes/bars-movie.css">
<script src="/jquery-bar-rating/dist/jquery.barrating.min.js"></script>
<div class="br-wrapper br-theme-bars-movie">
  <select id="score">
      <option value="0">免讀</option>
      <option value="1">可讀</option>
      <option value="2">應讀</option>
      <option value="3">必讀</option>
  </select>
</div>
<br/><br/>
<div id="distribution">
  <%= render 'rate_distribution' %>
</div>
<input type="button" id="rate" value="評價這本書">
<script type="text/javascript">
jQuery(function($) {
    $('#score').barrating({
        theme: 'bars-movie',
        initialRating: 2,
        readonly: true
    });

    $("#rate").click(function() {
      $('#score').barrating('readonly', false);
      $('#score').barrating('set', '6');
      $(this).attr('value', '送出評價');
      $(this).unbind('click');
      $(this).click(function(){
        var score = $('.br-current').attr('data-rating-value');
        $.ajax({
          url: '/books/add_rate',
          type: 'POST',
          dataType: 'json',
          data: {score: score, book: '<%= @book.id %>' },
          success: function(data){
            $('#score').barrating('set', data);
            $('#distribution').html("<%= raw normalize render 'rate_distribution' %>");
          }
        });
        $('#score').barrating('readonly', true);
        $(this).attr('value', '已評價');
        $(this).unbind('click');
        $(this).prop('disabled', true);
      });
    });
});
</script>